{"version":3,"sources":["webparts/fileUpload/components/FileUpload.tsx"],"names":[],"mappings":"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","file":"webparts/fileUpload/components/FileUpload.js","sourcesContent":["import * as React from 'react';\r\nimport styles from './FileUpload.module.scss';\r\nimport { IFileUploadProps } from './IFileUploadProps';\r\nimport { escape } from '@microsoft/sp-lodash-subset';\r\nimport { Log,UrlQueryParameterCollection } from '@microsoft/sp-core-library';\r\nimport DropzoneComponent from 'react-dropzone-component';\r\nimport pnp,{Web} from 'sp-pnp-js';\r\nexport default class FileUpload extends React.Component<IFileUploadProps, {}> {\r\n  constructor(props: IFileUploadProps){\r\n    super(props);  \r\n  }\r\n  public render(): React.ReactElement<IFileUploadProps> {\r\n    let _context = this.props.context;\r\n    let _listName = this.props.listName;\r\n    let _fileUploadTo=this.props.uploadFilesTo;\r\n    let _queryStringParam = this.props.queryString;\r\n    let queryParameters = new UrlQueryParameterCollection(window.location.href);\r\n    let _itemId = queryParameters.getValue(_queryStringParam);\r\n    let _parent = this;\r\n    let componentConfig = {\r\n      iconFiletypes: this.props.fileTypes.split(','),\r\n      showFiletypeIcon: true,\r\n      postUrl: _context.pageContext.web.absoluteUrl\r\n    };\r\n    let myDropzone;\r\n    let eventHandlers = {\r\n      // This one receives the dropzone object as the first parameter\r\n      // and can be used to additional work with the dropzone.js\r\n      // object\r\n      init: function(dz){       \r\n       myDropzone=dz;\r\n      },\r\n      removedfile: function(file){\r\n        let web:Web=new Web(_context.pageContext.web.absoluteUrl);     \r\n        if(_fileUploadTo==\"DocumentLibrary\"){\r\n          web.lists.getById(_listName).rootFolder.files.getByName(file.name).delete().then(t=>{\r\n            //add your code here if you want to do more after deleting the file\r\n          });\r\n        }\r\n        else{\r\n          web.lists.getById(_listName).items.getById(Number(_itemId)).attachmentFiles.deleteMultiple(file.name).then(t=>{            \r\n            //add your code here if you want to do more after deleting the file\r\n          });\r\n        }          \r\n      },\r\n      processing: function (file, xhr) {\r\n        \r\n        if(_fileUploadTo==\"DocumentLibrary\")\r\n          myDropzone.options.url = `${_context.pageContext.web.absoluteUrl}/_api/web/Lists/getById('${_parent.props.listName}')/rootfolder/files/add(overwrite=true,url='${file.name}')`;          \r\n        else\r\n        {          \r\n          if(_itemId)\r\n            myDropzone.options.url = `${_context.pageContext.web.absoluteUrl}/_api/web/lists/getById('${_parent.props.listName}')/items(${_itemId})/AttachmentFiles/add(FileName='${file.name}')`;\r\n          else\r\n            alert('Item non trouvé ou query null!')\r\n        }\r\n      },\r\n      sending: function (file, xhr) {\r\n        let _send = xhr.send;\r\n        xhr.send = function () {\r\n          _send.call(xhr, file);\r\n        };\r\n      },\r\n      error:function(file,error,xhr){\r\n        if(_fileUploadTo!=\"DocumentLibrary\")\r\n          alert(`File '${file.name}' existe deja. Renommez le fichier ou choisissez en un autre.`);\r\n        //if(myDropzone)\r\n        //  myDropzone.removeFile(file);\r\n      }\r\n     };\r\n    var djsConfig = {\r\n      headers: {\r\n        \"X-RequestDigest\": this.props.digest\r\n      },\r\n      addRemoveLinks:false\r\n    };\r\n    return (\r\n      <DropzoneComponent eventHandlers={eventHandlers} djsConfig={djsConfig} config={componentConfig}>\r\n        <div className=\"dz-message icon\">Vous avez un document à soumettre ? Placez-le ici<img className=\"upload-icon\" src=\"https://upload.wikimedia.org/wikipedia/commons/thumb/2/27/Noun_Project_cloud_upload_icon_411593_cc.svg/1130px-Noun_Project_cloud_upload_icon_411593_cc.svg.png\"></img></div>\r\n      </DropzoneComponent>\r\n    );\r\n  }\r\n}\r\n"],"sourceRoot":"..\\..\\..\\..\\src"}